# Grow Arm Animation

This guide shows how to implement a smooth "grow arm" animation for the Lite Mandala component, featuring soothing energy rings that flow inward from outside the spiral.

## Animation Interface

```typescript
interface GrowthAnimation {
  active: boolean;
  startTime: number;
  fromArms: number;
  toArms: number;
}
```

## Component Props

Add the `growthAnimation` prop to your canvas component:

```typescript
interface LiteMandalaCanvasProps {
  parameters: MandalaParameters;
  width?: number;
  height?: number;
  className?: string;
  animate?: boolean;
  growthAnimation?: GrowthAnimation;
}
```

## Easing Functions

```typescript
const easeOutCubic = (t: number) => 1 - Math.pow(1 - t, 3);
const easeInOutQuart = (t: number) => 
  t < 0.5 ? 8 * t * t * t * t : 1 - Math.pow(-2 * t + 2, 4) / 2;
```

## Animation Logic in Draw Function

Add this at the start of your `drawMandala` function:

```typescript
const drawMandala = (
  ctx: CanvasRenderingContext2D, 
  time: number, 
  w: number, 
  h: number, 
  darkMode: boolean, 
  growth?: GrowthAnimation
) => {
  const { arms: baseArms = 6, /* other params */ } = parameters;

  let arms = baseArms;
  let growthProgress = 0;
  let glowIntensity = 0;
  
  if (growth?.active) {
    const elapsed = time - growth.startTime;
    const duration = 3500; // 3.5 seconds
    const rawProgress = Math.min(elapsed / duration, 1);
    growthProgress = easeInOutQuart(rawProgress);
    
    // Glow fades in, holds, then fades out
    if (rawProgress < 0.3) {
      glowIntensity = easeOutCubic(rawProgress / 0.3);
    } else if (rawProgress < 0.7) {
      glowIntensity = 1;
    } else {
      glowIntensity = 1 - easeOutCubic((rawProgress - 0.7) / 0.3);
    }
    
    // Smoothly interpolate arm count
    arms = growth.fromArms + (growth.toArms - growth.fromArms) * growthProgress;
  }
  
  // ... rest of drawing code
};
```

## Energy Rings Effect

Draw soothing rings that flow inward from outside the spiral. Add this after drawing the background but before drawing the spiral:

```typescript
if (glowIntensity > 0) {
  const ringCount = 3;
  const animSpeed = time * 0.0015; // Slow, soothing speed
  
  for (let i = 0; i < ringCount; i++) {
    const ringPhase = (i / ringCount + animSpeed) % 1;
    const ringProgress = 1 - ringPhase;
    
    // Rings stay outside the spiral (which ends at maxRadius * 0.9)
    const outerStart = maxRadius * 1.3;
    const outerEnd = maxRadius * 0.95;
    const ringRadius = outerEnd + (outerStart - outerEnd) * ringProgress;
    
    // Soft fade in/out
    const ringAlpha = Math.sin(ringPhase * Math.PI) * glowIntensity * 0.35;
    
    if (ringAlpha > 0.01) {
      ctx.strokeStyle = `hsla(199, 70%, 60%, ${ringAlpha})`;
      ctx.lineWidth = 1.5;
      ctx.beginPath();
      ctx.arc(cx, cy, ringRadius, 0, Math.PI * 2);
      ctx.stroke();
    }
  }
}
```

## React State Management

```typescript
const [armCount, setArmCount] = useState(6);
const [growthAnimation, setGrowthAnimation] = useState<GrowthAnimation | undefined>();
const [isGrowing, setIsGrowing] = useState(false);

const handleGrowArm = () => {
  if (isGrowing || armCount >= 24) return;
  
  setIsGrowing(true);
  const newArmCount = armCount + 1;
  
  setGrowthAnimation({
    active: true,
    startTime: performance.now(),
    fromArms: armCount,
    toArms: newArmCount
  });
  
  // Animation duration: 3.5 seconds
  setTimeout(() => {
    setArmCount(newArmCount);
    setGrowthAnimation(undefined);
    setIsGrowing(false);
  }, 3500);
};
```

## Button Component

```tsx
<Button
  onClick={handleGrowArm}
  disabled={isGrowing || armCount >= 24}
  className="gap-2"
>
  <Plus className="w-4 h-4" />
  {isGrowing ? "Growing..." : `Grow Arm (${armCount} arms)`}
</Button>
```

## Render Loop Update

Make sure your render loop continues during the growth animation:

```typescript
useEffect(() => {
  // ... canvas setup ...

  const render = (timestamp: number) => {
    if (animate || growthAnimation?.active) {
      timeRef.current = timestamp;
    }
    drawMandala(ctx, timeRef.current, width, height, isDarkRef.current, growthAnimation);
    
    if (animate || growthAnimation?.active) {
      animationRef.current = requestAnimationFrame(render);
    }
  };

  render(timeRef.current);

  return () => {
    if (animationRef.current) {
      cancelAnimationFrame(animationRef.current);
    }
  };
}, [parameters, width, height, animate, isDark, growthAnimation]);
```

## Animation Timeline

| Time | Action |
|------|--------|
| 0.0s - 1.0s | Energy rings fade in, arm begins growing |
| 1.0s - 2.4s | Full ring intensity, arm continues growing |
| 2.4s - 3.5s | Rings fade out, arm finishes growing |

## Customization Options

- **Duration**: Change `3500` to adjust total animation time
- **Ring count**: Adjust `ringCount` for more/fewer energy rings
- **Ring speed**: Modify `animSpeed` multiplier (lower = slower)
- **Ring color**: Change the HSL values in `strokeStyle`
- **Ring opacity**: Adjust the `0.35` multiplier for glowIntensity
- **Ring position**: Modify `outerStart` and `outerEnd` to change ring range
